# マインスイーパー設計書

## 1. 概要

マインスイーパーは、地雷が隠されたフィールドで地雷を避けながらすべての安全なマスを開放するパズルゲームです。

## 2. 要件定義

### 2.1 基本機能要件

#### 必須機能
- **ゲーム盤の生成**: 指定されたサイズとマインの数で盤面を作成
- **マスの操作**:
  - 左クリック: マスを開ける
  - 右クリック: フラグの設置/解除
- **自動展開**: 隣接マインが0のマスを開いた際の連鎖開放
- **ゲーム状態管理**: 
  - 進行中 (Playing)
  - 勝利 (Won)
  - 敗北 (Lost)
- **タイマー機能**: ゲーム開始からの経過時間表示
- **マイン数表示**: 残りマイン数の表示

#### 追加機能
- **難易度選択**: 初級・中級・上級・カスタム
- **ゲームリセット**: 新しいゲームの開始
- **スコア記録**: 最短クリア時間の保存

### 2.2 非機能要件

- **パフォーマンス**: スムーズな操作感
- **レスポンシブデザイン**: 様々な画面サイズに対応
- **直感的なUI**: 分かりやすいアイコンとレイアウト

## 3. 技術仕様

### 3.1 推奨技術スタック

**フロントエンド**
- React 18+ (状態管理とコンポーネント化)
- TypeScript (型安全性)
- CSS Modules / Styled Components (スタイリング)

**ビルドツール**
- Vite (高速な開発環境)

**状態管理**
- React Context + useReducer (ゲーム状態管理)

### 3.2 アーキテクチャ

```
src/
├── components/          # UIコンポーネント
│   ├── Game/           # ゲーム全体
│   ├── Board/          # ゲーム盤
│   ├── Cell/           # 個別のマス
│   ├── Header/         # ヘッダー（タイマー、マイン数等）
│   └── Controls/       # 操作パネル
├── hooks/              # カスタムフック
│   ├── useGame.ts      # ゲームロジック
│   ├── useTimer.ts     # タイマー機能
│   └── useLocalStorage.ts # スコア保存
├── types/              # 型定義
├── utils/              # ユーティリティ関数
│   ├── gameLogic.ts    # ゲームロジック
│   └── constants.ts    # 定数定義
└── styles/             # グローバルスタイル
```

## 4. データ構造設計

### 4.1 ゲーム状態

```typescript
interface GameState {
  board: Cell[][];
  gameStatus: 'playing' | 'won' | 'lost';
  mineCount: number;
  flagCount: number;
  timer: number;
  difficulty: Difficulty;
}

interface Cell {
  isMine: boolean;
  isRevealed: boolean;
  isFlagged: boolean;
  adjacentMines: number;
  row: number;
  col: number;
}

interface Difficulty {
  name: string;
  rows: number;
  cols: number;
  mines: number;
}
```

### 4.2 定数定義

```typescript
const DIFFICULTIES = {
  BEGINNER: { name: '初級', rows: 9, cols: 9, mines: 10 },
  INTERMEDIATE: { name: '中級', rows: 16, cols: 16, mines: 40 },
  EXPERT: { name: '上級', rows: 16, cols: 30, mines: 99 }
};
```

## 5. ゲームロジック設計

### 5.1 盤面生成アルゴリズム

1. 指定サイズの2次元配列を作成
2. 最初のクリック位置を避けてマインをランダム配置
3. 各マスの隣接マイン数を計算

### 5.2 マス展開ロジック

1. **通常展開**: 選択したマスを開く
2. **連鎖展開**: 隣接マイン数が0の場合、隣接する未開放マスを再帰的に展開
3. **勝利判定**: すべての非マインマスが開放されたか確認

### 5.3 フラグ機能

- 右クリックでフラグを設置/解除
- フラグ付きマスは左クリックで開放不可
- 残りマイン数からフラグ数を減算して表示

## 6. UI/UX設計

### 6.1 レイアウト構成

```
┌─────────────────────────────────┐
│ ヘッダー                        │
│ [🚩 010] [😊] [⏱️ 000]         │
├─────────────────────────────────┤
│                                 │
│         ゲーム盤                │
│    □ □ □ □ □ □ □ □ □           │
│    □ □ □ □ □ □ □ □ □           │
│    □ □ □ □ □ □ □ □ □           │
│                                 │
├─────────────────────────────────┤
│ コントロール                    │
│ [新しいゲーム] [難易度選択]     │
└─────────────────────────────────┘
```

### 6.2 マス表示仕様

- **未開放**: グレーの立体ボタン
- **フラグ**: 🚩 アイコン
- **開放済み**: 
  - マイン: 💣 (赤背景)
  - 数字: 1-8 (色分け)
  - 空白: 白背景
- **ホバー効果**: マウスオーバー時のハイライト

### 6.3 レスポンシブ対応

- デスクトップ: 最大盤面サイズ
- タブレット: 中程度のマスサイズ
- スマートフォン: タッチ操作に最適化されたマスサイズ

## 7. 実装フェーズ

### Phase 1: 基本機能
1. 基本的なゲーム盤の表示
2. マスの開放機能
3. マイン配置とゲーム終了判定

### Phase 2: 操作機能
1. フラグ機能
2. 連鎖展開
3. タイマー機能

### Phase 3: UI強化
1. レスポンシブデザイン
2. アニメーション効果
3. 難易度選択

### Phase 4: 追加機能
1. スコア記録
2. カスタム難易度
3. 統計情報

## 8. テスト方針

### 8.1 単体テスト
- ゲームロジック関数のテスト
- 盤面生成アルゴリズムのテスト
- 勝利/敗北判定のテスト

### 8.2 統合テスト
- ユーザー操作フローのテスト
- ゲーム状態遷移のテスト

### 8.3 E2Eテスト
- 完全なゲームプレイのシナリオテスト